<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login con Google</title>
    <!-- Carica la libreria di Google Sign-In -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>

    <h2>Login con Google</h2>
    <div id="g-signin2"></div>

    <script>
        // Funzione che viene chiamata quando l'utente effettua il login con successo
        function onSuccess(googleUser) {
            const token = googleUser.getAuthResponse().id_token;  // Ottieni il token ID di Google

            // Invia il token al server per validarlo e ottenere un JWT personalizzato
            fetch('http://localhost:7118/api/auth/google-login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ idToken: token }),
            })
                .then(response => response.json())
                .then(data => {
                    // Salva il JWT nel localStorage (se necessario)
                    localStorage.setItem('token', data.token);
                    console.log('Utente loggato con successo');
                })
                .catch(error => {
                    console.log('Errore nel login:', error);
                });
        }

        // Funzione di errore nel caso di fallimento
        function onFailure(error) {
            console.log('Errore di login con Google:', error);
        }

        // Carica e inizializza la libreria Google Sign-In
        function initGoogleSignIn() {
            if (typeof gapi !== 'undefined') {
                gapi.load('auth2', function () {
                    gapi.auth2.init({
                        client_id: '774580121408-hc4tut3oohk2p2v2q5e0j6liq4a3q62d.apps.googleusercontent.com' // Usa il tuo vero Client ID
                    }).then(function () {
                        // Rende il pulsante di login visibile
                        gapi.signin2.render('g-signin2', {
                            'scope': 'profile email',
                            'longtitle': true,
                            'theme': 'dark',
                            'onsuccess': onSuccess,
                            'onfailure': onFailure
                        });
                    });
                });
            } else {
                console.error("gapi non è definito, assicurati che la libreria sia caricata correttamente");
            }
        }

        // Chiamata per inizializzare il login quando la pagina è completamente caricata
        window.onload = initGoogleSignIn;
    </script>

</body>
</html>
